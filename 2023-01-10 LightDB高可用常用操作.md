### LightDB-高可用常用操作

- #### 监控
1. 查看节点间同步状态及延迟
```sql
#在主机上，进入数据库
[lightdb@localhost bin]$ ltsql
lightdb@lt_test=# \x (ps:格式化输出结果模式)
Expanded display is on.
lightdb@lt_test=# SELECT * FROM pg_stat_replication; --在主机上主库查询
-[ RECORD 1 ]----+-------------------------------
pid              | 5447
usesysid         | 24173
usename          | ltcluster
application_name | lightdbCluster1921681211135432
client_addr      | 192.168.121.113
client_hostname  | 
client_port      | 47010
backend_start    | 2023-01-10 15:52:10.283457+08
backend_xmin     | 
state            | streaming
sent_lsn         | 0/61DA9A90
write_lsn        | 0/61DA9A90
flush_lsn        | 0/61DA9A90
replay_lsn       | 0/61DA9A90
write_lag        | 00:00:00.000758
flush_lag        | 00:00:00.00136
replay_lag       | 00:00:00.00137
sync_priority    | 1
sync_state       | sync
reply_time       | 2023-01-10 17:07:22.23154+08

#在备机上执行
[lightdb@localhost bin]$ ltsql
lightdb@lt_test=# \x
Expanded display is on.
lightdb@lt_test=# SELECT * FROM pg_stat_wal_receiver; --备 库 查 询
-[ RECORD 1 ]---------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
pid                   | 3699
status                | streaming
receive_start_lsn     | 0/60000000
receive_start_tli     | 1
written_lsn           | 0/61F9AE58
flushed_lsn           | 0/61F9AE58
received_tli          | 1
last_msg_send_time    | 2023-01-10 17:14:18.670279+08
last_msg_receipt_time | 2023-01-10 17:14:18.66869+08
latest_end_lsn        | 0/61F9AE58
latest_end_time       | 2023-01-10 17:14:18.670279+08
slot_name             | ltcluster_slot_2
sender_host           | 192.168.121.112
sender_port           | 5432
conninfo              | user=ltcluster passfile=/home/lightdb/.pgpass channel_binding=prefer connect_timeout=2 dbname=replication host=192.168.121.112 port=5432 application_name=lightdbCluster1921681211135432 fallback_application_name=walreceiver sslmode=prefer sslcompression=0 ssl_min_protocol_version=TLSv1.2 gssencmode=disable krbsrvname=postgres target_session_attrs=any

```

- 查看各节点状态
